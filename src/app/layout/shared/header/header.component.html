<header class="sticky-top header-dark">
  <div class="container d-flex align-items-center" style="height: 56px;">
    <div class="d-none d-md-flex w-100 align-items-center">
      <a routerLink="/" class="header-brand d-flex align-items-center me-4">
        <i class="bi bi-house me-2"></i>
        Social Media Detox
      </a>

      <div class="flex-grow-1 d-flex align-items-center">
        <ng-container *ngTemplateOutlet="navItems"></ng-container>
      </div>

      <!-- Header Icons -->
      <div class="d-flex align-items-center ms-auto">
        <div class="header-icon me-3" (click)="navigateToSearchResults()">
          <i class="bi bi-search"></i>
        </div>

        <div ngbDropdown class="header-icon me-3" placement="bottom-end">
          <div class="btn-header" ngbDropdownToggle>
            <i class="bi bi-bell"></i>
            <span class="notification-badge" *ngIf="hasUnreadNotifications">1</span>
          </div>
          <div ngbDropdownMenu class="dropdown-menu-end">
            <div class="px-3 py-2 text-muted" *ngIf="!notifications.length">
              No new notifications
            </div>
            <ng-container *ngFor="let notification of notifications">
              <button ngbDropdownItem (click)="markNotificationAsRead(notification)">
                {{ notification.message }}
              </button>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile View -->
    <div class="d-flex d-md-none align-items-center w-100">
      <button class="btn btn-header me-2" (click)="openOffcanvas()">
        <i class="bi bi-list"></i>
        <span class="visually-hidden">Toggle Menu</span>
      </button>
      <a routerLink="/" class="header-brand d-flex align-items-center">
        <i class="bi bi-house me-2"></i>
        Social Media Detox
      </a>
    </div>
  </div>
</header>

<ng-template #navItems>
  <div ngbDropdown class="d-inline-block me-2" [placement]="isMobile ? 'bottom-start' : 'bottom-end'" *ngIf="currentUser">
    <button class="btn btn-link" id="accountTasksDropdown" ngbDropdownToggle>
      <i class="bi bi-person-check desktop-icon"></i>
      <span class="mobile-label">Account Tasks</span>
    </button>
    <div ngbDropdownMenu aria-labelledby="accountTasksDropdown">
      <button ngbDropdownItem (click)="navigateToTopics()">Topics</button>
      <button ngbDropdownItem (click)="navigateToContentTypes()">Content Types</button>
      <button ngbDropdownItem (click)="navigateToSubTopics()">Sub Topics</button>
      <button ngbDropdownItem (click)="navigateToChannels()">Channels</button>
      <button ngbDropdownItem (click)="navigateToDefaultTopics()">Default Topics</button>
      <button ngbDropdownItem (click)="navigateToSearchResults()">Search Results</button>
    </div>
  </div>
  <div ngbDropdown class="d-inline-block" [placement]="isMobile ? 'bottom-start' : 'bottom-end'">
    <button class="btn btn-link" id="accountDropdown" ngbDropdownToggle>
      <i class="bi bi-person desktop-icon"></i>
      <span class="mobile-label">{{ currentUser ? 'Account' : 'Login/Register' }}</span>
    </button>
    <div ngbDropdownMenu aria-labelledby="accountDropdown">
      <ng-container *ngIf="!currentUser">
        <button ngbDropdownItem (click)="openLoginModal()">Login</button>
        <button ngbDropdownItem (click)="openRegisterModal()">Register</button>
      </ng-container>
      <ng-container *ngIf="currentUser">
        <button ngbDropdownItem (click)="navigateToAccountProfile()">Account Profile</button>
        <button ngbDropdownItem (click)="navigateToChangePassword()">Change Password</button>
        <button ngbDropdownItem (click)="navigateToChangeEmail()">Change Email</button>
        <button ngbDropdownItem (click)="logout()">Logout</button>
      </ng-container>
    </div>
  </div>
</ng-template>

<ng-template #offcanvasContent let-offcanvas>
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Menu</h5>
    <button type="button" class="btn-close" (click)="offcanvas.dismiss()"></button>
  </div>
  <div class="offcanvas-body">
    <nav class="d-flex flex-column">
      <ng-container *ngTemplateOutlet="navItems"></ng-container>
    </nav>
  </div>
</ng-template>
